<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mod.io Integration</title>
  <style>
    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background-color: #000000;
      color: #ffffff;
      margin: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .navbar {
      background-color: #007bff;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
    }

    .navbar h1 {
      margin: 0;
      font-size: 24px;
    }

    .navbar .user-info {
      position: relative;
    }

    .navbar .user-info img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
    }

    .dropdown-menu {
      position: absolute;
      top: 50px;
      right: 0;
      background-color: #1e1e1e;
      border: 1px solid #444;
      border-radius: 4px;
      display: none;
      padding: 10px;
      text-align: left;
      z-index: 10;
    }

    .dropdown-menu button {
      display: block;
      background: none;
      color: white;
      padding: 5px 10px;
      border: none;
      text-align: left;
      cursor: pointer;
    }

    .dropdown-menu button:hover {
      background-color: #333;
    }

    .container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .content {
      background: #2e2e2e;
      padding: 20px;
      border-radius: 8px;
      width: 100%;
      max-width: 500px;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    h1, h2 {
      color: #ffffff;
    }

    button {
      padding: 10px 20px;
      background: none;
      color: white;
      border: 2px solid white;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
    }

    button:hover, button:focus {
      background-color: #007bff;
      border-color: #0056b3;
    }

    input, textarea, select {
      width: calc(100% - 20px);
      margin: 10px 0;
      padding: 10px;
      border: 1px solid #444;
      border-radius: 4px;
      background-color: #444;
      color: white;
    }

    input:disabled, textarea:disabled {
      background-color: #333;
      color: #777;
    }
  </style>
</head>
<body>
  <div class="navbar">
    <h1>Mod.io Mods</h1>
    <div id="user-info" class="user-info">
      <img id="user-avatar" src="" alt="User Avatar">
      <div class="dropdown-menu" id="dropdown-menu">
        <button id="logout-button">Logout</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="content">
      <h2>Submit a Mod</h2>
      <form id="mod-upload-form">
        <input type="text" id="mod-name" placeholder="Mod Name" required disabled>
        <textarea id="mod-description" placeholder="Mod Description" rows="5" required disabled></textarea>
        <input type="file" id="mod-file" required disabled>
        <button type="button" id="submit-mod-button" disabled>Submit Mod</button>
      </form>
      <p id="login-message">Please log in to upload mods.</p>
    </div>
  </div>

  <script>
    const MODIO_CLIENT_ID = '34180771';
    const REDIRECT_URI = "https://latesttaggers.site/blog/modding";
    const API_BASE = "https://api.mod.io/v1";

    document.addEventListener('DOMContentLoaded', () => {
      handleOAuthRedirect();

      document.getElementById('logout-button').addEventListener('click', () => {
        localStorage.removeItem('modio_access_token');
        window.location.reload();
      });

      const avatar = document.getElementById('user-avatar');
      const dropdownMenu = document.getElementById('dropdown-menu');
      avatar.addEventListener('click', () => {
        dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
      });

      document.getElementById('submit-mod-button').addEventListener('click', async () => {
        const modName = document.getElementById('mod-name').value;
        const modDescription = document.getElementById('mod-description').value;
        const modFile = document.getElementById('mod-file').files[0];
        const accessToken = localStorage.getItem('modio_access_token');

        if (modName && modDescription && modFile && accessToken) {
          const formData = new FormData();
          formData.append('name', modName);
          formData.append('description', modDescription);
          formData.append('file', modFile);

          try {
            const response = await fetch(`${API_BASE}/mods`, {
              method: 'POST',
              headers: {
                Authorization: `Bearer ${accessToken}`,
              },
              body: formData,
            });

            if (response.ok) {
              const data = await response.json();
              alert(`Mod uploaded successfully! Mod ID: ${data.id}`);
            } else {
              const error = await response.json();
              alert(`Error: ${error.message}`);
            }
          } catch (error) {
            console.error('Error uploading mod:', error);
          }
        } else {
          alert('Please complete all fields.');
        }
      });
    });

    async function handleOAuthRedirect() {
      const hashParams = new URLSearchParams(window.location.hash.substring(1));
      const accessToken = hashParams.get('access_token');

      if (accessToken) {
        localStorage.setItem('modio_access_token', accessToken);
        await fetchUserInfo(accessToken);
        enableUploadForm();
      } else {
        const storedToken = localStorage.getItem('modio_access_token');
        if (storedToken) {
          await fetchUserInfo(storedToken);
          enableUploadForm();
        }
      }
    }

    async function fetchUserInfo(token) {
      try {
        const response = await fetch(`${API_BASE}/me`, {
          headers: { Authorization: `Bearer ${token}` },
        });

        if (response.ok) {
          const userData = await response.json();
          document.getElementById('user-avatar').src = userData.avatar.thumb_50x50 || '';
          document.getElementById('login-message').style.display = 'none';
          document.getElementById('user-info').style.display = 'flex';
        }
      } catch (error) {
        console.error('Error fetching user info:', error);
      }
    }

    function enableUploadForm() {
      document.getElementById('mod-name').disabled = false;
      document.getElementById('mod-description').disabled = false;
      document.getElementById('mod-file').disabled = false;
      document.getElementById('submit-mod-button').disabled = false;
      document.getElementById('login-message').style.display = 'none';
    }
  </script>
</body>
</html>
